<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="/Development/Installation-Guide/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Installation Guide - My Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">My Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../About/Framework-Benchmarks">Framework Benchmarks</a>
                            </li>
                        
                            <li >
                                <a href="../../About/TechEmpower">TechEmpower</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Information <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../ProjectInformation/Concepts">Basic Concepts</a>
                            </li>
                        
                            <li >
                                <a href="../../ProjectInformation/Codebase">TODO - Intro to Codebase</a>
                            </li>
                        
                            <li >
                                <a href="../../ProjectInformation/Framework-Tests">Framework Tests</a>
                            </li>
                        
                            <li >
                                <a href="../../ProjectInformation/Environment">Environment</a>
                            </li>
                        
                            <li >
                                <a href="../../ProjectInformation/Terminology">Terminology</a>
                            </li>
                        
                            <li >
                                <a href="../../ProjectInformation/Expected-Questions">Expected Questions</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Development <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../Contributing-Guide">Contributing Guide</a>
                            </li>
                        
                            <li >
                                <a href="../Getting-Started">Getting Guide</a>
                            </li>
                        
                            <li class="active">
                                <a href=".">Installation Guide</a>
                            </li>
                        
                            <li >
                                <a href="../Add-Frameworks-or-Tests">Add Frameworks or Tests</a>
                            </li>
                        
                            <li >
                                <a href="../Testing-and-Debugging">Testing and Debugging</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Benchmarking <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../Benchmarking/Getting-Started-Benchmarking">Getting Started</a>
                            </li>
                        
                            <li >
                                <a href="../../Benchmarking/Running-the-Benchmark">Run the Benchmark</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../Support/Converse">Join the Conversation</a>
                            </li>
                        
                            <li >
                                <a href="../../Support/FAQ">FAQ</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">**hidden** <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            <li >
                                <a href="../../Codebase/Configuration-File">Configuration File</a>
                            </li>
                        
                            <li >
                                <a href="../../Codebase/Framework-Benchmark-Config-File">Framework Benchmark Config File</a>
                            </li>
                        
                            <li >
                                <a href="../../Codebase/Framework-Install-File">Framework Install File</a>
                            </li>
                        
                            <li >
                                <a href="../../Codebase/Framework-Setup-File">Framework Setup File</a>
                            </li>
                        
                            <li >
                                <a href="../../Codebase/Summary-of-Script-Directories">Summary of Script Directories</a>
                            </li>
                        
                            <li >
                                <a href="../Vagrant-Development-Environment">Vagrant Development Environment</a>
                            </li>
                        
                        </ul>
                    </li>
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                
                <li >
                    <a rel="next" href="../Getting-Started">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../Add-Frameworks-or-Tests">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#installation-basics">Installation Basics</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>If you're looking to quickly get started developing using the vagrant development environment, consider the <a href="../../../Codebase/Vagrant-Development-Environment">vagrant development environment guide</a>. </p>
<p>Take a look at the <a href="../../Codebase/Summary-of-Script-Directories">Summary of Script Directories section</a> to figure out which directory has scripts relevant to your use case (development or benchmarking).</p>
<h1 id="installation-basics">Installation Basics</h1>
<p>In order for SSH to work appropriately, the user on <strong>each machine</strong> will need to be 
set up to have passwordless sudo access.</p>
<p><strong>Setting up the <code>user</code></strong></p>
<pre><code class="bash">sudo vim /etc/sudoers
</code></pre>

<p>You will need to change the line that reads <code>%sudo   ALL=(ALL:ALL) ALL</code> to 
<code>%sudo   ALL=(ALL:ALL) NOPASSWD: ALL</code>. You should be able to exit your shell, ssh 
back in and perform <code>sudo ls</code> without being prompted for a password.</p>
<p><strong>NOTE</strong> Again, you will have to do this on every machine: server, database, client.</p>
<p><strong>Setting up SSH</strong></p>
<p>You will need to also be able to SSH onto each of the 3 machines from any of the
3 machines and not be prompted for a password. We use an identity file and authorized_keys
file to accomplish this.</p>
<pre><code class="bash">ssh-keygen -t rsa
</code></pre>

<p>This will prompt you for various inputs; leave them all blank and just hit 'enter'.
Next, you will want to allow connections identified via that key signature, so add
it to your authorized keys.</p>
<pre><code class="bash">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
</code></pre>

<p>Next, you will need these exact same files to exist on the other 2 machines.
If you properly set up your user account on all 3 machines, then this will not prompt
you for a password (if it does, go back to "Setting up the <code>user</code>" and fix it).</p>
<pre><code class="bash"># Export some variables so you can copy/paste the rest.
export TFB_SERVER_USER=[your server user]
export TFB_SERVER_HOST=[your server ip]
export TFB_DATABASE_USER=[your database user]
export TFB_DATABASE_HOST=[database ip]
export TFB_CLIENT_USER=[your client user]
export TFB_CLIENT_HOST=[client ip]
# Set up the database machine for SSH
cat ~/.ssh/id_rsa.pub | ssh $TFB_DATABASE_USER@$TFB_DATABASE_HOST 'mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys'
scp ~/.ssh/id_rsa $TFB_DATABASE_USER@$TFB_DATABASE_HOST:~/.ssh/id_rsa
scp ~/.ssh/id_rsa.pub $TFB_DATABASE_USER@$TFB_DATABASE_HOST:~/.ssh/id_rsa.pub
# Set up the client machine for SSH
cat ~/.ssh/id_rsa.pub | ssh $TFB_CLIENT_USER@$TFB_CLIENT_HOST 'mkdir -p ~/.ssh &amp;&amp; cat &gt;&gt; ~/.ssh/authorized_keys'
scp ~/.ssh/id_rsa $TFB_CLIENT_USER@$TFB_CLIENT_HOST:~/.ssh/id_rsa
scp ~/.ssh/id_rsa.pub $TFB_CLIENT_USER@$TFB_CLIENT_HOST:~/.ssh/id_rsa.pub
</code></pre>

<p>Now, test it all out, you should be able to execute all of the following without
being prompted for a password. <strong>NOTE</strong> The first time you SSH to these machines
(read: in this step) you will be prompted to accept the signature - do it.</p>
<pre><code class="bash"># Test your database SSH setup
ssh $TFB_DATABASE_HOST
# Accept the signature
# You are connected to the database machine!
sudo ls
# This should NOT prompt for a password and list the directory's contents
# If this is not true, go back to &quot;Setting up the `user`&quot; and fix it
exit
# Test your client SSH setup
ssh $TFB_CLIENT_HOST
# Accept the signature
# You are connected to the client machine!
sudo ls
# We also need to test that we can SSH back to the server machine
ssh [enter your server ip again]
# Accept the signature
# You are connected to the server machine!
sudo ls
# If this works, you are golden!
exit
# Back on client
exit
# Back on initial ssh connection to server machine
</code></pre>

<p>Last, the benchmarks require that every framework test be run under a different
user than the one who executes the <code>run-tests.py</code> script. Creating a <code>runner_user</code> named "testrunner" is simple:</p>
<pre><code class="bash"># Change this value to whatever username you want
export RUNNER=testrunner
# Get your primary user
export ME=$(id -u -n)
# Create the new testrunner user
sudo useradd $RUNNER
# Give him a home dir
sudo mkdir /home/$RUNNER
# Make testrunner the owner of his home dir
sudo chown $RUNNER:$RUNNER /home/$RUNNER
# Add the testrunner user to every group that the travis user is in
sudo sed -i 's|:'&quot;$ME&quot;'|:'&quot;$ME&quot;','&quot;$RUNNER&quot;'|g' /etc/group
# Add the testrunner user to the travis group specifically
sudo sed -i 's|'&quot;$ME&quot;':x:\(.*\):|'&quot;$ME&quot;':x:\1:'&quot;$RUNNER&quot;'|g' /etc/group
# Add the travis user to the testrunner group
sudo sed -i 's|'&quot;$RUNNER&quot;':x:\(.*\):|'&quot;$RUNNER&quot;':x:\1:'&quot;$ME&quot;'|g' /etc/group
# Add testrunner to the sudoers group
echo &quot;$RUNNER ALL=(ALL:ALL) NOPASSWD: ALL&quot; | sudo tee -a /etc/sudoers
# Set the default shell for testrunner to /bin/bash
sudo sed -i 's|/home/'&quot;$RUNNER&quot;':.*|/home/'&quot;$RUNNER&quot;':/bin/bash|g' /etc/passwd
</code></pre>

<p><strong>Setting up prerequisites</strong></p>
<p>The suite requires that a few libraries and applications are installed in order to run.
First, clone our repository.</p>
<pre><code class="bash">git clone https://github.com/TechEmpower/FrameworkBenchmarks.git
cd FrameworkBenchmarks
source toolset/setup/linux/prerequisites.sh
sudo apt-get install -y python-pip
sudo pip install -r config/python_requirements.txt
</code></pre>

<p>To install TFB components onto the various servers, you must provide
basic login details for each server (e.g. usernames, IP addresses, 
private key files). While these details can all be passed 
using command line flags, it's easier to use a configuration 
file and avoid having huge flag lists in your commands. </p>
<pre><code class="bash">cp benchmark.cfg.example benchmark.cfg
vim benchmark.cfg
</code></pre>

<p>You will need to change, at a minimum, the following:</p>
<ul>
<li><code>client_host</code> Set this to the IP address of your client machine</li>
<li><code>client_identity_file</code> Set to <code>/home/[username]/.ssh/id_rsa</code></li>
<li><code>client_user</code> Set to your username</li>
<li><code>runner_user</code> Set to your runner's username</li>
<li><code>database_host</code> Set this to the IP address of your database machine</li>
<li><code>database_identity_file</code> Set to <code>/home/[username]/.ssh/id_rsa</code></li>
<li><code>database_user</code> Set to your username</li>
<li><code>server_host</code> Set this to the IP address of your server machine</li>
</ul>
<p>At this point, you should be ready to install the suite.</p>
<p>We use the <code>--install-only</code> flag in our examples to 
prevent launching tests at this stage. All of these commands 
should be run from the <code>app server</code> - it will SSH into other
hosts as needed. For more information on how TFB installation 
works, see <a href="../../deployment">here</a>. </p>
<p><strong>Setting up the <code>load server</code></strong></p>
<pre><code class="bash">toolset/run-tests.py --install client --install-only
</code></pre>

<p><strong>Setting up the <code>database server</code></strong></p>
<pre><code class="bash">toolset/run-tests.py --install database --install-only
</code></pre>

<p><strong>Setting up the <code>app server</code></strong></p>
<p>At this point, you should be able to run a benchmark of the entire
suite or selectively run individual benchmarks. Additionally, you
can test your setup by running a verification on one of the stable
frameworks. Since we wrote it, we tend to test with <code>gemini</code>:</p>
<pre><code class="bash">toolset/run-tests.py --mode verify --test gemini
</code></pre>

<p>You can find the results for this verification step under the directory:
<code>results/ec2/latest/logs/gemini</code>. There should be an <code>err</code> and an <code>out</code>
file.</p>
<p>You can choose to selectively install components by using the 
<code>--test</code> and <code>--exclude</code> flags. </p>
<pre><code class="bash"># Install just the software for beego (as an example)
toolset/run-tests.py --install server --test beego --verbose --install-only

# Install all php software but php-fuel (as another example)
toolset/run-tests.py --install server --test php* --exclude php-fuel --verbose install-only

# Install *all* framework software. Expect this to take hours!
# If running on a remote server, use `screen` or `tmux` or `nohup` to 
# prevent the installation from being terminated if you are disconnected
$ toolset/run-tests.py --install server --verbose --install-only
</code></pre>

</div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>